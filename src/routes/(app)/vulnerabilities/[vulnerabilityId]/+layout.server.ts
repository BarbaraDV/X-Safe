import { redirect } from "@sveltejs/kit";

export async function load({ locals, params }) {
  const vulnerability = await locals.pb
    .collection("vulnerabilities")
    .getOne(params.vulnerabilityId, {
      expand: "author,incident,comments.author",
    });
  if (vulnerability.deleted && !locals.user?.admin) {
    throw redirect(301, "/app");
  }
  return {
    vulnerability,
  };
}
